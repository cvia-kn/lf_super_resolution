import numpy as np
from scipy import linalg
from skimage import img_as_float, dtype_limits


def rgb2YCbCr(img):
    img_y = 0.256789 * img[:,:,0] + 0.504129 * img[:,:,1] + 0.097906 * img[:,:,2] + 16/255
    img_cb = -0.148223 * img[:,:,0] - 0.290992 * img[:,:,1] + 0.439215 * img[:,:,2] + 128/255
    img_cr = 0.439215 * img[:,:,0] - 0.367789 * img[:,:,1] - 0.071426 * img[:,:,2] + 128/255

    img_ycbcr = np.zeros(img.shape)
    img_ycbcr[:, :, 0] = img_y
    img_ycbcr[:, :, 1] = img_cb
    img_ycbcr[:, :, 2] = img_cr

    return img_ycbcr


def YCbCr2rgb(img):
    img_rgb = np.zeros(img.shape)

    # img_rgb[:, :, 0] = 1.164383*(img[:,:,0]-16/255)+3.011244*(img[:,:,1]-128/255)+1.596027*(img[:,:,2]-128/255)
    # img_rgb[:, :, 1] = 1.164383*(img[:,:,0]-16/255)-0.391762*(img[:,:,1]-128/255)-0.812969*(img[:,:,2]-128/255)
    # img_rgb[:, :, 2] = 1.164383*(img[:,:,0]-16/255)+2.017230*(img[:,:,1]-128/255)+3.054262*(img[:,:,2]-128/255)

    img_rgb[:, :, 0] = 1.164383 * (img[:, :, 0] - 16 / 255) + 1.596027 * (
                img[:, :, 2] - 128 / 255)
    img_rgb[:, :, 1] = 1.164383 * (img[:, :, 0] - 16 / 255) - 0.391762 * (img[:, :, 1] - 128 / 255) - 0.812969 * (
                img[:, :, 2] - 128 / 255)
    img_rgb[:, :, 2] = 1.164383 * (img[:, :, 0] - 16 / 255) + 2.017230 * (img[:, :, 1] - 128 / 255)

    # img_rgb[:, :, 0] = 1.164383 * (img[:, :, 0]) + 1.596027 * (img[:, :, 2])-222.912/255
    # img_rgb[:, :, 1] = 1.164383 * (img[:, :, 0]) - 0.391762 * (img[:, :, 1]) - 0.812969 * (
    #         img[:, :, 2])+135.488/255
    # img_rgb[:, :, 2] = 1.164383 * (img[:, :, 0]) + 2.017230 * (img[:, :, 1]) -276.928/255

    return img_rgb